const insertJSONDataToTable = function(client, callback) {
  const jsonData =
    '[{"id": 56,"title": "Cimarron Kid, The","genre": "Western","average_rating": 4.3,"release_year": "06-Sep-2013"}, {"id": 34,"title": "Black Moon","genre": "Fantasy|Mystery|Sci-Fi|War","average_rating": 4.4,"release_year": "03-Jul-2003"}, {"id": 39,"title": "When Ladies Meet","genre": "Comedy|Drama|Romance","average_rating": 3.7,"release_year": "26-Aug-1996"}, {"id": 23,"title": "One True Thing","genre": "Drama","average_rating": 1.9,"release_year": "15-Jul-1999"}, {"id": 75,"title": "Satanic Rites of Dracula, The","genre": "Horror","average_rating": 3.4,"release_year": "10-Mar-2011"}, {"id": 96,"title": "Torpedo Run","genre": "Drama|War","average_rating": 4.4,"release_year": "21-Jan-1999"}, {"id": 22,"title": "The Spectacular Now","genre": "Comedy|Drama|Romance","average_rating": 2.7,"release_year": "03-May-2015"}, {"id": 50,"title": "Tennessee Johnson","genre": "Drama","average_rating": 4.2,"release_year": "11-May-1997"}, {"id": 25,"title": "X-Men","genre": "Action|Adventure|Sci-Fi","average_rating": 1.9,"release_year": "08-Jan-1990"}, {"id": 17,"title": "House IV","genre": "Fantasy|Horror|Thriller","average_rating": 2.5,"release_year": "10-Apr-1992"}, {"id": 33,"title": "Memorial Day","genre": "Action|Drama|War","average_rating": 2.7,"release_year": "16-Apr-1999"}, {"id": 51,"title": "Frida","genre": "Drama|Romance","average_rating": 4.0,"release_year": "31-Oct-2003"}, {"id": 63,"title": "I Want You","genre": "Drama|Romance","average_rating": 3.9,"release_year": "02-Jan-1991"}, {"id": 68,"title": "Tyler Perrys For Colored Girls","genre": "Drama","average_rating": 3.0,"release_year": "07-Oct-2014"}, {"id": 78,"title": "Trick","genre": "Comedy|Romance","average_rating": 1.6,"release_year": "13-Mar-2012"}, {"id": 19,"title": "Light Bulb Conspiracy, The","genre": "Documentary","average_rating": 4.3,"release_year": "07-Jan-2015"}, {"id": 40,"title": "Mission Congo","genre": "Documentary","average_rating": 4.5,"release_year": "04-Oct-1990"}, {"id": 46,"title": "Bait","genre": "Action|Horror|Thriller","average_rating": 2.6,"release_year": "11-Aug-2002"}, {"id": 21,"title": "City Zero","genre": "Comedy|Drama|Sci-Fi","average_rating": 2.4,"release_year": "13-Aug-1992"}, {"id": 47,"title": "Young at Heart","genre": "Drama|Musical|Romance","average_rating": 4.4,"release_year": "07-Feb-2011"}, {"id": 84,"title": "Stavisky...","genre": "Crime|Drama","average_rating": 2.7,"release_year": "26-Aug-2009"}, {"id": 90,"title": "Stash House","genre": "Thriller","average_rating": 4.0,"release_year": "28-Feb-1999"}, {"id": 12,"title": "Americas Most Haunted Inns","genre": "Documentary","average_rating": 1.1,"release_year": "29-Nov-1998"}, {"id": 66,"title": "Severed Arm, The","genre": "Crime|Horror","average_rating": 4.8,"release_year": "09-Apr-2016"}, {"id": 46,"title": "Patriot Games","genre": "Action|Thriller","average_rating": 3.1,"release_year": "08-May-2017"}, {"id": 93,"title": "Hunting Party, The","genre": "Action|Drama|Western","average_rating": 4.6,"release_year": "24-May-2014"}, {"id": 12,"title": "Lovers of the Arctic Circle, The (Los Amantes del Círculo Polar)","genre": "Drama|Romance","average_rating": 3.3,"release_year": "04-Oct-1994"}, {"id": 79,"title": "Killers, The","genre": "Action|Crime|Drama|Film-Noir|Thriller","average_rating": 2.8,"release_year": "18-Jun-2014"}, {"id": 35,"title": "Butch Cassidy and the Sundance Kid","genre": "Action|Western","average_rating": 2.0,"release_year": "02-Dec-1991"}, {"id": 90,"title": "Istanbul","genre": "(no genres listed)","average_rating": 2.9,"release_year": "05-Jun-1999"}, {"id": 46,"title": "Jimmys Hall","genre": "Drama","average_rating": 3.6,"release_year": "27-Jun-2015"}, {"id": 50,"title": "Hipnos","genre": "Horror|Thriller","average_rating": 4.9,"release_year": "01-Aug-1991"}, {"id": 57,"title": "Armageddon (Armaguedon)","genre": "Crime|Thriller","average_rating": 3.9,"release_year": "11-May-2009"}, {"id": 29,"title": "Two Cents Worth of Hope (Due soldi di speranza)","genre": "Comedy|Romance","average_rating": 4.0,"release_year": "28-Jul-2012"}, {"id": 95,"title": "21 Grams","genre": "Crime|Drama|Mystery|Romance|Thriller","average_rating": 2.8,"release_year": "08-Dec-2007"}, {"id": 63,"title": "Godzilla Raids Again (Gojira no gyakushû)","genre": "Action|Drama|Horror|Romance|Sci-Fi","average_rating": 4.2,"release_year": "19-Jun-2005"}, {"id": 27,"title": "I Inside, The","genre": "Fantasy|Mystery|Sci-Fi","average_rating": 2.3,"release_year": "15-Dec-1996"}, {"id": 49,"title": "How to Beat the High Cost of Living","genre": "Comedy","average_rating": 4.1,"release_year": "22-Mar-2013"}, {"id": 13,"title": "Plaisir, Le","genre": "Comedy|Drama","average_rating": 2.8,"release_year": "02-Apr-2018"}, {"id": 83,"title": "Countdown to Zero","genre": "Documentary","average_rating": 2.0,"release_year": "19-Aug-2002"}, {"id": 34,"title": "Kamikaze","genre": "Drama","average_rating": 1.1,"release_year": "12-Mar-1999"}, {"id": 23,"title": "Enchantment","genre": "Drama|Romance","average_rating": 4.0,"release_year": "09-Sep-2014"}, {"id": 80,"title": "Futurama: The Beast with a Billion Backs","genre": "Action|Animation|Comedy|Romance|Sci-Fi","average_rating": 2.8,"release_year": "22-Aug-2000"}, {"id": 58,"title": "Brother Minister: The Assassination of Malcolm X","genre": "Documentary","average_rating": 3.3,"release_year": "08-Mar-1995"}, {"id": 46,"title": "Zatoichi and the Chess Expert (Zatôichi Jigoku tabi) (Zatôichi 12)","genre": "Action|Drama","average_rating": 4.6,"release_year": "05-Dec-1997"}, {"id": 68,"title": "Godzilla vs. Destroyah (Gojira vs. Desutoroiâ) ","genre": "Action|Sci-Fi","average_rating": 4.5,"release_year": "23-Jan-2016"}, {"id": 86,"title": "Narrow Margin","genre": "Crime|Thriller","average_rating": 1.6,"release_year": "26-Aug-2009"}, {"id": 51,"title": "Love Lasts Three Years (Lamour dure trois ans)","genre": "Comedy|Drama|Romance","average_rating": 3.9,"release_year": "18-Apr-2011"}, {"id": 14,"title": "I Hope They Serve Beer in Hell","genre": "Comedy","average_rating": 1.3,"release_year": "03-Mar-2006"}, {"id": 4,"title": "Blast from the Past","genre": "Comedy|Romance","average_rating": 1.8,"release_year": "06-May-1994"}, {"id": 67,"title": "Born in East L.A.","genre": "Comedy","average_rating": 2.7,"release_year": "19-Jul-1998"}, {"id": 52,"title": "Artifact","genre": "Documentary","average_rating": 1.1,"release_year": "28-Jul-2005"}, {"id": 66,"title": "The King and Four Queens","genre": "Adventure|Comedy|Mystery|Western","average_rating": 1.4,"release_year": "16-Oct-2000"}, {"id": 43,"title": "Crazy, Stupid, Love.","genre": "Comedy|Drama|Romance","average_rating": 3.9,"release_year": "06-Jan-2004"}, {"id": 23,"title": "Chris Rock: Bring the Pain","genre": "Comedy","average_rating": 2.3,"release_year": "21-Jul-2002"}, {"id": 16,"title": "Bottom of the Sea, The (El fondo del mar)","genre": "Drama|Thriller","average_rating": 3.3,"release_year": "06-Jun-1998"}, {"id": 49,"title": "Baader Meinhof Komplex, Der","genre": "Action|Crime|Drama|Thriller","average_rating": 3.3,"release_year": "29-Dec-2000"}, {"id": 76,"title": "Hoffa","genre": "Crime|Drama","average_rating": 3.3,"release_year": "11-Sep-2010"}, {"id": 28,"title": "Sherlock Holmes","genre": "Mystery|Sci-Fi","average_rating": 3.9,"release_year": "26-Feb-2006"}, {"id": 90,"title": "Nightmare Before Christmas, The","genre": "Animation|Children|Fantasy|Musical","average_rating": 4.7,"release_year": "31-Oct-1993"}, {"id": 34,"title": "Boys Diving, Honolulu","genre": "Documentary","average_rating": 4.6,"release_year": "12-Mar-2018"}, {"id": 76,"title": "Alphabet","genre": "Documentary","average_rating": 2.8,"release_year": "21-Jul-2009"}, {"id": 96,"title": "Tyson","genre": "Drama","average_rating": 4.6,"release_year": "27-Dec-1994"}, {"id": 39,"title": "Front Line, The (Go-ji-jeon)","genre": "Drama|War","average_rating": 4.0,"release_year": "17-Jun-2001"}, {"id": 36,"title": "Water Horse: Legend of the Deep, The","genre": "Adventure|Children|Fantasy","average_rating": 5.0,"release_year": "01-Jul-1992"}, {"id": 44,"title": "Fat, Sick & Nearly Dead","genre": "Documentary","average_rating": 1.9,"release_year": "16-Dec-1997"}, {"id": 75,"title": "Quartet","genre": "Drama|Romance","average_rating": 1.1,"release_year": "07-Jun-2010"}, {"id": 16,"title": "Blue Blood","genre": "Documentary","average_rating": 4.6,"release_year": "04-May-2002"}, {"id": 24,"title": "Blade of the Ripper","genre": "Drama|Horror|Mystery|Romance|Thriller","average_rating": 4.1,"release_year": "08-Sep-1997"}, {"id": 5,"title": "Mother Küsters Goes to Heaven (Mutter Küsters Fahrt zum Himmel)","genre": "Drama","average_rating": 3.6,"release_year": "02-Apr-2004"}, {"id": 58,"title": "Boot, Das (Boat, The)","genre": "Action|Drama|War","average_rating": 2.1,"release_year": "03-Sep-2017"}, {"id": 50,"title": "Billy the Kid","genre": "Drama|Western","average_rating": 3.5,"release_year": "07-Feb-1997"}, {"id": 36,"title": "Perfumed Nightmare","genre": "Comedy|Drama","average_rating": 4.2,"release_year": "16-Dec-2005"}, {"id": 5,"title": "Painless (Insensibles) ","genre": "Fantasy|Horror|Mystery|War","average_rating": 3.4,"release_year": "17-Oct-1995"}, {"id": 67,"title": "Stella Street","genre": "Comedy","average_rating": 2.3,"release_year": "09-Jul-2006"}, {"id": 18,"title": "Suit for Wedding, A (a.k.a. The Wedding Suit) (Lebassi Baraye Arossi)","genre": "Drama","average_rating": 3.3,"release_year": "03-Jan-2014"}, {"id": 88,"title": "High Roller: The Stu Ungar Story","genre": "Drama","average_rating": 3.1,"release_year": "29-Apr-1991"}, {"id": 32,"title": "Perfect Fake, A","genre": "Documentary","average_rating": 2.8,"release_year": "07-Jun-1990"}, {"id": 89,"title": "Lilith","genre": "Drama","average_rating": 1.1,"release_year": "09-Nov-1999"}, {"id": 17,"title": "Patience Stone, The","genre": "Drama|War","average_rating": 3.0,"release_year": "13-Oct-2007"}, {"id": 43,"title": "Childrens Hour, The","genre": "Drama","average_rating": 3.2,"release_year": "11-May-1996"}, {"id": 57,"title": "Into the Woods","genre": "Adventure|Comedy|Fantasy|Musical","average_rating": 1.5,"release_year": "20-Sep-1991"}, {"id": 3,"title": "Mars Needs Moms","genre": "Action|Adventure|Animation|Children|Comedy|Sci-Fi|IMAX","average_rating": 5.0,"release_year": "19-Mar-2004"}, {"id": 1,"title": "Injury to One, An","genre": "Documentary","average_rating": 2.0,"release_year": "25-Dec-2014"}, {"id": 42,"title": "The French Kissers","genre": "Comedy","average_rating": 1.7,"release_year": "06-Oct-1993"}, {"id": 55,"title": "PK","genre": "Comedy|Drama|Fantasy|Mystery|Romance","average_rating": 1.8,"release_year": "01-Jun-2007"}, {"id": 28,"title": "Neverland","genre": "Adventure|Fantasy","average_rating": 1.5,"release_year": "27-Feb-2013"}, {"id": 80,"title": "Fatherland","genre": "Action|Drama","average_rating": 3.1,"release_year": "14-Dec-1992"}, {"id": 49,"title": "Merry War, A","genre": "Comedy","average_rating": 3.7,"release_year": "23-Jun-1992"}, {"id": 77,"title": "Jackass 3.5","genre": "Comedy|Documentary","average_rating": 4.7,"release_year": "03-Jun-2017"}, {"id": 90,"title": "Carmen","genre": "Drama","average_rating": 1.8,"release_year": "13-Mar-2013"}, {"id": 95,"title": "Passing Strange","genre": "Documentary|Musical","average_rating": 4.6,"release_year": "20-Apr-2011"}, {"id": 62,"title": "Bye-Bye","genre": "Drama","average_rating": 2.3,"release_year": "13-Dec-2007"}, {"id": 8,"title": "All the Young Men","genre": "Drama|War","average_rating": 4.4,"release_year": "28-Nov-1990"}, {"id": 3,"title": "Lynch","genre": "Documentary","average_rating": 3.1,"release_year": "31-Jul-2007"}, {"id": 38,"title": "Journey for Margaret","genre": "Drama|War","average_rating": 4.8,"release_year": "03-Feb-2015"}, {"id": 58,"title": "Heavens Burning","genre": "Action|Drama","average_rating": 1.0,"release_year": "04-Jul-2008"}, {"id": 45,"title": "Pacific Rim","genre": "Action|Adventure|Sci-Fi|IMAX","average_rating": 4.0,"release_year": "24-Jun-2011"}, {"id": 1,"title": "Bluebeard","genre": "Thriller","average_rating": 3.0,"release_year": "06-Mar-2005"}, {"id": 25,"title": "Mercenary for Justice","genre": "Action","average_rating": 2.9,"release_year": "17-May-1998"}]';
  const query =
    "insert into movie select * from json_populate_recordset(null::movie, '" +
    jsonData +
    "')";

  client
    .query(query)
    .then(res => {
      console.log("Successfully inserted all the data in Movie table.", res);
      callback(null, res);
    })
    .catch(e => {
      console.log("Error Occured inside private function:", e.stack);
      callback(e.stack, null);
    });
};

module.exports.addJSONData = function(event, callback) {
  require("../config/postgresConfig")(true, function(error, client) {
    if (error) {
      callback(error, null);
    } else {
      client
        .query(
          "CREATE TABLE MOVIE(id INT, title VARCHAR(50), genre VARCHAR(50), average_rating DECIMAL(2,1), release_year DATE);"
        )
        .then(res => {
          console.log("Movie table created");
          insertJSONDataToTable(client, callback);
        })
        .catch(e => {
          if (e.stack.includes("already exists")) {
            insertJSONDataToTable(client, callback);
          } else {
            callback(e.stack, null);
          }
        });
    }
  });
};
